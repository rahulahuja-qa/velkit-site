<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Resume & Cover Letter Builder Â· Velkit</title>
<link rel="stylesheet" href="/assets/styles.css"/>
</head><body>
<header>
  <div class="container" style="display:flex;align-items:center;gap:.75rem">
    <a href="/" style="display:flex;align-items:center;gap:.75rem">
      <img src="/assets/velkit-logo.png" alt="Velkit" style="height:40px;width:auto"/>
    </a>
    <a href="mailto:hello@velkit.io" class="btn" style="margin-left:auto">Contact</a>
  </div>
</header>

<main class="container">
  <h1>Resume &amp; Cover Letter Builder</h1>
  <form id="f" class="card" style="display:grid;gap:1rem">
    <input name="name" placeholder="Your name" required/>
    <input name="contact" placeholder="Contact (email/phone/location)" required/>
    <input name="role" placeholder="Target role" required/>
    <input name="years_exp" type="number" min="0" placeholder="Years of experience"/>
    <input name="skills" placeholder="Key skills (comma-separated)"/>
    <textarea name="job_description" placeholder="Paste job description" required></textarea>
    <div style="display:flex;gap:.75rem;flex-wrap:wrap">
      <button class="btn" id="btnGen" type="submit">Generate</button>
      <button class="btn" id="btnDocx" type="button">Download .docx</button>
    </div>
  </form>

  <section id="out" class="grid hidden">
    <div class="card"><h2>Cover Letter</h2><pre id="cl" style="white-space:pre-wrap"></pre></div>
    <div class="card"><h2>Resume</h2><pre id="cv" style="white-space:pre-wrap"></pre></div>
  </section>
</main>

<script>
const f = document.getElementById("f");
const out = document.getElementById("out");
const cl = document.getElementById("cl");
const cv = document.getElementById("cv");

function readForm(fd){
  return {
    name: String(fd.get("name")||""),
    contact: String(fd.get("contact")||""),
    role: String(fd.get("role")||""),
    years_exp: Number(fd.get("years_exp")||0),
    skills: String(fd.get("skills")||"").split(",").map(s=>s.trim()).filter(Boolean),
    job_description: String(fd.get("job_description")||"")
  };
}

f.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const body = readForm(new FormData(f));
  const r = await fetch("/api/builder?format=json", {
    method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(body)
  });
  if(!r.ok){ alert("Request failed: " + r.status); return; }
  const j = await r.json();
  out.classList.remove("hidden");
  cl.textContent = j.cover_letter || JSON.stringify(j,null,2);
  cv.textContent = JSON.stringify(j.resume || j, null, 2);
});

document.getElementById("btnDocx").addEventListener("click", async ()=>{
  const body = readForm(new FormData(f));
  const r = await fetch("/api/builder?format=docx", {
    method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(body)
  });
  if(!r.ok){ alert("Request failed: " + r.status); return; }
  const blob = await r.blob();
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement("a"), { href: url, download: "velkit-builder.docx" });
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
</script>
</body></html>
